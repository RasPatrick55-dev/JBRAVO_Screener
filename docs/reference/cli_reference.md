# CLI Reference

Generated by `python -m scripts.docs_consistency_check` from live `--help` output.

## `python -m scripts.run_pipeline --help`

```text
usage: run_pipeline.py [-h] [--steps STEPS] [--reload-web {true,false}]
                       [--screener-args SCREENER_ARGS]
                       [--screener-args-split [SCREENER_ARGS_SPLIT ...]]
                       [--backtest-args BACKTEST_ARGS]
                       [--backtest-args-split [BACKTEST_ARGS_SPLIT ...]]
                       [--backtest-quick {true,false}]
                       [--metrics-args METRICS_ARGS]
                       [--metrics-args-split [METRICS_ARGS_SPLIT ...]]
                       [--labels-bars-path LABELS_BARS_PATH]
                       [--ranker-eval-args RANKER_EVAL_ARGS]
                       [--ranker-eval-args-split [RANKER_EVAL_ARGS_SPLIT ...]]
                       [--enrich-candidates-with-ranker]
                       [--export-daily-bars-path EXPORT_DAILY_BARS_PATH]

Run the JBRAVO daily pipeline

options:
  -h, --help            show this help message and exit
  --steps STEPS         Comma-separated list of steps to run (default:
                        screener,backtest,metrics,ranker_eval). Include
                        'labels' to generate label CSVs.
  --reload-web {true,false}
                        Reload the hosted web application on completion
  --screener-args SCREENER_ARGS
                        Extra CLI arguments forwarded to scripts.screener
  --screener-args-split [SCREENER_ARGS_SPLIT ...]
                        Extra CLI arguments for scripts.screener provided as
                        separate tokens
  --backtest-args BACKTEST_ARGS
                        Extra CLI arguments forwarded to scripts.backtest
  --backtest-args-split [BACKTEST_ARGS_SPLIT ...]
                        Extra CLI arguments for scripts.backtest provided as
                        separate tokens
  --backtest-quick {true,false}
                        Enable quick backtest mode by forwarding --quick to
                        scripts.backtest
  --metrics-args METRICS_ARGS
                        Extra CLI arguments forwarded to scripts.metrics
  --metrics-args-split [METRICS_ARGS_SPLIT ...]
                        Extra CLI arguments for scripts.metrics provided as
                        separate tokens
  --labels-bars-path LABELS_BARS_PATH
                        Path to a daily bars CSV used by the optional labels
                        step (default: data/daily_bars.csv)
  --ranker-eval-args RANKER_EVAL_ARGS
                        Extra CLI arguments forwarded to scripts.ranker_eval
  --ranker-eval-args-split [RANKER_EVAL_ARGS_SPLIT ...]
                        Extra CLI arguments for scripts.ranker_eval provided
                        as separate tokens
  --enrich-candidates-with-ranker
                        Append model scores from the latest predictions file
                        onto latest_candidates.csv. Runs automatically when
                        ranker_eval is in --steps.
  --export-daily-bars-path EXPORT_DAILY_BARS_PATH
                        Optional path to write fetched daily bars as CSV
                        (default: data/daily_bars.csv)
```

## `python -m scripts.execute_trades --help`

```text
usage: execute_trades.py [-h] [--source {db,path}] [--source-path SOURCE_PATH]
                         [--allocation-pct ALLOCATION_PCT]
                         [--alloc-weight-key {score,model_score,none}]
                         [--min-order-usd MIN_ORDER_USD]
                         [--max-positions MAX_POSITIONS]
                         [--max-new-positions MAX_NEW_POSITIONS]
                         [--disable-open-position-cap | --no-disable-open-position-cap]
                         [--entry-buffer-bps ENTRY_BUFFER_BPS]
                         [--limit-buffer-pct LIMIT_BUFFER_PCT]
                         [--max-gap-pct MAX_GAP_PCT]
                         [--ref-buffer-pct REF_BUFFER_PCT]
                         [--gap-refboost-pct GAP_REFBOOST_PCT]
                         [--gap-marketable-pct GAP_MARKETABLE_PCT]
                         [--marketable-bps MARKETABLE_BPS]
                         [--trailing-percent TRAILING_PERCENT]
                         [--cancel-after-min CANCEL_AFTER_MIN]
                         [--max-poll-secs MAX_POLL_SECS]
                         [--extended-hours EXTENDED_HOURS]
                         [--submit-at-ny SUBMIT_AT_NY]
                         [--price-source {prevclose,entry,close,blended}]
                         [--price-band-pct PRICE_BAND_PCT]
                         [--price-band-action {clamp,skip}]
                         [--chase-interval-minutes CHASE_INTERVAL_MINUTES]
                         [--max-chase-count MAX_CHASE_COUNT]
                         [--max-chase-gap-pct MAX_CHASE_GAP_PCT]
                         [--chase-enabled] [--dry-run DRY_RUN] [--diagnostic]
                         [--allow-bump-to-one ALLOW_BUMP_TO_ONE]
                         [--allow-fractional ALLOW_FRACTIONAL]
                         [--position-sizer {notional,atr}]
                         [--atr-target-pct ATR_TARGET_PCT]
                         [--min-adv20 MIN_ADV20] [--min-price MIN_PRICE]
                         [--max-price MAX_PRICE] [--log-json LOG_JSON]
                         [--reconcile-only [RECONCILE_ONLY]]
                         [--no-reconcile-only]
                         [--reconcile-auto RECONCILE_AUTO]
                         [--reconcile-lookback-days RECONCILE_LOOKBACK_DAYS]
                         [--reconcile-limit RECONCILE_LIMIT]
                         [--reconcile-use-watermark RECONCILE_USE_WATERMARK]
                         [--reconcile-overlap-secs RECONCILE_OVERLAP_SECS]
                         [--time-window {premarket,regular,any,auto}]
                         [--market-tz MARKET_TIMEZONE]

Execute trades for pipeline candidates

options:
  -h, --help            show this help message and exit
  --source {db,path}    Candidate source: db (latest run in PostgreSQL) or
                        path (CSV file)
  --source-path SOURCE_PATH
                        Path to candidates CSV when --source path
  --allocation-pct ALLOCATION_PCT
                        Fraction of buying power allocated per position (0-1)
  --alloc-weight-key {score,model_score,none}
                        Column used for proportional allocation weights
  --min-order-usd MIN_ORDER_USD
                        Minimum USD notional target per slot before rounding
  --max-positions MAX_POSITIONS
                        Maximum BUY entries allowed per calendar trading day
  --max-new-positions MAX_NEW_POSITIONS
                        Maximum number of new entry attempts per run
  --disable-open-position-cap, --no-disable-open-position-cap
                        Disable open-position count caps as an execution
                        blocker
  --entry-buffer-bps ENTRY_BUFFER_BPS
                        Entry buffer in basis points added to the reference
                        price
  --limit-buffer-pct LIMIT_BUFFER_PCT
                        Percent tolerance added to entry/anchor prices
                        (default 0.5)
  --max-gap-pct MAX_GAP_PCT
                        Max percent above previous close allowed for prevclose
                        anchoring (env: MAX_GAP_PCT)
  --ref-buffer-pct REF_BUFFER_PCT
                        Percent buffer added to live reference prices (env:
                        REF_BUFFER_PCT, default 0.75)
  --gap-refboost-pct GAP_REFBOOST_PCT
                        Gap percent above prevclose that triggers ref-buffer
                        boost (default 1.0)
  --gap-marketable-pct GAP_MARKETABLE_PCT
                        Gap percent above prevclose that triggers marketable
                        limit (default 3.0)
  --marketable-bps MARKETABLE_BPS
                        Basis points above ref trade for marketable limit
                        price (default 25)
  --trailing-percent TRAILING_PERCENT
                        Percent trail for the protective stop order
  --cancel-after-min CANCEL_AFTER_MIN
                        Minutes after regular market open to cancel unfilled
                        orders
  --max-poll-secs MAX_POLL_SECS
                        Seconds to poll an order before detaching (no cancel)
                        and moving on
  --extended-hours EXTENDED_HOURS
                        Whether to submit orders eligible for extended hours
  --submit-at-ny SUBMIT_AT_NY
                        Target HH:MM in America/New_York to start submitting
                        (premarket)
  --price-source {prevclose,entry,close,blended}
                        Anchor price source for limit orders (prevclose falls
                        back to snapshot/bars/entry, blended uses prevclose
                        and live reference prices)
  --price-band-pct PRICE_BAND_PCT
                        Safety band percent for prevclose anchoring (default
                        10.0)
  --price-band-action {clamp,skip}
                        Action when live prices deviate outside the band
  --chase-interval-minutes CHASE_INTERVAL_MINUTES
                        Minutes to wait between chase attempts
  --max-chase-count MAX_CHASE_COUNT
                        Maximum number of chase attempts to reprice open
                        orders
  --max-chase-gap-pct MAX_CHASE_GAP_PCT
                        Max percent above anchor/prevclose allowed during
                        chase repricing
  --chase-enabled       Enable periodic chasing of unfilled limit orders
  --dry-run DRY_RUN     If true, only log intended actions without submitting
                        orders
  --diagnostic          Diagnostic mode: run allocation logic and emit metrics
                        without submitting or canceling orders
  --allow-bump-to-one ALLOW_BUMP_TO_ONE
                        Allow bumping position size to one share when sizing
                        rounds to zero
  --allow-fractional ALLOW_FRACTIONAL
                        Allow fractional share orders when full shares are not
                        affordable
  --position-sizer {notional,atr}
                        Strategy used to determine order size (default:
                        notional)
  --atr-target-pct ATR_TARGET_PCT
                        Target ATR% used when position_sizer=atr (expressed as
                        decimal, e.g. 0.02)
  --min-adv20 MIN_ADV20
                        Minimum 20-day average dollar volume required
  --min-price MIN_PRICE
                        Minimum allowed price for candidates
  --max-price MAX_PRICE
                        Maximum allowed price for candidates
  --log-json LOG_JSON   Emit structured JSON logs in addition to human
                        readable ones
  --reconcile-only [RECONCILE_ONLY]
                        Run reconciliation of closed trades and exit without
                        placing new orders
  --no-reconcile-only   Disable reconcile-only mode and continue to order
                        submission
  --reconcile-auto RECONCILE_AUTO
                        Automatically reconcile closed trades at start and end
                        of executor run (default: true)
  --reconcile-lookback-days RECONCILE_LOOKBACK_DAYS
                        Lookback window in days for reconciliation queries
                        (default 14)
  --reconcile-limit RECONCILE_LIMIT
                        Maximum number of orders fetched during reconciliation
                        (default 500)
  --reconcile-use-watermark RECONCILE_USE_WATERMARK
                        Use reconcile watermark stored in DB to fetch
                        incremental orders (default: true)
  --reconcile-overlap-secs RECONCILE_OVERLAP_SECS
                        Seconds of overlap when advancing reconcile watermark
                        (default 300)
  --time-window {premarket,regular,any,auto}
                        Trading time window gate controlling when orders may
                        be submitted
  --market-tz, --market-timezone MARKET_TIMEZONE
                        IANA timezone name used for market window evaluation
```

## `python -m scripts.screener --help`

```text
usage: screener.py [-h]
                   --mode {screener,delta-update,build-symbol-stats,coarse-features,full-nightly}
                   [--universe {alpaca-active,csv}] [--source-csv SOURCE_CSV]
                   [--output-dir OUTPUT_DIR] [--run-date RUN_DATE]
                   [--ranker-config RANKER_CONFIG] [--local-validate]
                   [--days DAYS] [--prefilter-days PREFILTER_DAYS]
                   [--prefilter-top PREFILTER_TOP] [--full-days FULL_DAYS]
                   [--min-days-fallback MIN_DAYS_FALLBACK]
                   [--min-days-final MIN_DAYS_FINAL] [--feed {iex,sip}]
                   [--bars-source {http,sdk}]
                   [--fetch-mode {auto,batch,single}]
                   [--batch-size BATCH_SIZE] [--max-workers MAX_WORKERS]
                   [--limit LIMIT] [--symbols SYMBOLS] [--top-n TOP_N]
                   [--min-history MIN_HISTORY] [--iex-only {true,false}]
                   [--liquidity-top LIQUIDITY_TOP]
                   [--exclude-otc | --no-exclude-otc] [--verify-request]
                   [--reuse-cache {true,false}] [--skip-fetch {true,false}]
                   [--export-daily-bars-path EXPORT_DAILY_BARS_PATH]
                   [--refresh-latest {true,false}]
                   [--gate-preset {strict,standard,mild}]
                   [--relax-gates {none,sma_only,cross_or_rsi}]
                   [--debug-no-gates {true,false}]
                   [--dollar-vol-min DOLLAR_VOL_MIN]

Run the nightly screener

options:
  -h, --help            show this help message and exit
  --mode {screener,delta-update,build-symbol-stats,coarse-features,full-nightly}
                        Pipeline mode to run
  --universe {alpaca-active,csv}
                        Universe source to use for screener input
  --source-csv SOURCE_CSV
                        Path to input OHLC CSV (used when --universe csv)
  --output-dir OUTPUT_DIR
                        Directory to write outputs (defaults to repo root)
  --run-date RUN_DATE   Override run_date for DB writes (YYYY-MM-DD)
  --ranker-config RANKER_CONFIG
                        Path to the ranker configuration file (default:
                        configs/ranker_v2.yml)
  --local-validate      Fail fast locally if bars/indicators missing or
                        fallback is used
  --days DAYS           Number of trading days to request
  --prefilter-days PREFILTER_DAYS
                        Lookback window (trading days) for coarse prefilter
                        inputs
  --prefilter-top PREFILTER_TOP
                        Shortlist size to carry into the nightly stage
  --full-days FULL_DAYS
                        Lookback window (trading days) for full feature
                        computation
  --min-days-fallback MIN_DAYS_FALLBACK
                        Fallback trading-day window when the primary request
                        returns no bars
  --min-days-final MIN_DAYS_FINAL
                        Final trading-day window if the fallback still returns
                        no bars
  --feed {iex,sip}      Market data feed to request from Alpaca
  --bars-source {http,sdk}
                        Source for fetching bars data
  --fetch-mode {auto,batch,single}
                        Strategy for fetching bars: auto (default), batch, or
                        single
  --batch-size BATCH_SIZE
                        Maximum symbols per batch for bar requests
  --max-workers MAX_WORKERS
                        Maximum workers for single-symbol fallback
  --limit LIMIT         Optional symbol limit for development/testing
  --symbols SYMBOLS     Comma-separated list of symbols to override the Alpaca
                        universe
  --top-n TOP_N
  --min-history MIN_HISTORY
  --iex-only {true,false}
                        Restrict universe to exchanges covered by IEX
                        (default: true)
  --liquidity-top LIQUIDITY_TOP
                        Keep only the top N symbols by recent volume (0
                        disables)
  --exclude-otc, --no-exclude-otc
                        Exclude OTC symbols from the universe (default: true)
  --verify-request      Log and capture the first bars request for debugging
  --reuse-cache {true,false}
                        Reuse cached bars batches when available (default:
                        true)
  --skip-fetch {true,false}
                        Skip remote bars fetch and reuse cached data (default:
                        false)
  --export-daily-bars-path EXPORT_DAILY_BARS_PATH
                        Optional path to write fetched daily bars as CSV
                        (default: disabled)
  --refresh-latest {true,false}
                        (deprecated) ignored; DB is source of truth
  --gate-preset {strict,standard,mild}
                        Gate thresholds preset (default: standard)
  --relax-gates {none,sma_only,cross_or_rsi}
                        Optional relaxation override for diagnostics (default:
                        none)
  --debug-no-gates {true,false}
                        Bypass gating for verification (runs sentiment on full
                        shortlist; not for production)
  --dollar-vol-min DOLLAR_VOL_MIN
                        Minimum ADV20 dollar volume required for gate pass
                        (default: 2000000)
```
